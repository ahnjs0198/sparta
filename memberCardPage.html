<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>멤버 소개 페이지</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

    <style>
      .memberPage {
        display: none;
        position: fixed;
        left: 0;
        top: 0;
        z-index: 10;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
      }

      .memberPage > .inner {
        margin: 50px auto 0px auto;
        background: white;
        border-radius: 16px;
        width: 450px;
        min-height: 650px;
        max-height: 800px;
      }

      .memberImg {
        border-radius: 16px 16px 0px 0px;
        width: 450px;
        height: 450px;
      }

      .memberContent {
        margin-bottom: 5px;
        padding: 0px 10px 10px 10px;
      }

      .btnbox {
        position: absolute;
        right: 0px;
        margin: 8px 8px 0px 0px;
      }

      .topbox {
        background-color: transparent;
        position: relative;
      }

      .contentbtnbox {
        float: right;
        margin-bottom: 5px;
        margin-right: 5px;
      }
      .contentbtnbox > button {
        font-size: 14px;
        border: 0px;
        background-color: transparent;
      }

      .memberCloseBtn {
        color: white;
        font-size: 14px;
        border: 0px;
        background-color: transparent;
        height: 20px;
      }
    </style>
    <script type="module">
      // Firebase SDK 라이브러리 가져오기
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import {
        collection,
        addDoc,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import {
        getDocs,
        query,
        where,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

      // Your web app's Firebase configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBYxw3ecQiQXkldn41y9XaW3Wuua_bk8V8",
        authDomain: "introducetim.firebaseapp.com",
        projectId: "introducetim",
        storageBucket: "introducetim.appspot.com",
        messagingSenderId: "332412628842",
        appId: "1:332412628842:web:f3a7ebbf18a5de55c07f13",
      };

      // Firebase 인스턴스 초기화
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      //멤버 카드 클릭시 실행 이벤트 - 멤버데이터 가져오고 페이지 오픈
      $(".col").click(async function () {
        let memberName = $(this).find(".card-title").text();

        // 파이어베이스에서 데이터 가져오기
        // let docs = await getDocs(collection(db, "members"));
        const q = query(
          collection(db, "members"),
          where("name", "==", memberName)
        );
        const querySnapshot = await getDocs(q);
        querySnapshot.forEach((doc) => {
          let row = doc.data();

          let name = row["name"];
          let mbti = row["mbti"];
          let hobby = row["hobby"];
          let githubAddr = row["githubAddr"];
          let introduceMyself = row["introduceMyself"];
          let image = row["image"];

          $("#memberImg").attr("src", image);
          $("#memberName").text(name);
          $("#memberMBTI").text(mbti);
          $("#memberHobby").text(hobby);
          $("#githubAddr").text(githubAddr);
          $("#introduceMyself").text(introduceMyself);
        });

        // 페이지 오픈 함수
        memberPageOpen();
      });
    </script>
    <script>
      //멤버카드 소개 페이지 관련 script

      //멤버 카드 페이지 열기
      async function memberPageOpen() {
        $("#memberPage").fadeIn();
      }
      //멤버 카드 페이지 닫기
      function memberPageClose() {
        $("#memberPage").fadeOut();
      }

      //멤버 수정 함수
      function modifyMember() {
        let result = prompt("인증비밀번호를 입력하세요", "");
        if (result == "1234") {
          location.href = "modify.html";
        }
      }

      //멤버 삭제 함수
      function DeleteMember() {
        let result = prompt("인증비밀번호를 입력하세요", "");
        if (result == "1234") {
          location.href = "main.html";
        }
      }

      // 외부영역 클릭 시 팝업 닫기
      $(document).mouseup(function (e) {
        var LayerPopup = $("#memberPage");
        if (LayerPopup.has(e.target).length === 0) {
          $("#memberPage").fadeOut();
        }
      });
    </script>
  </head>

  <body>
    <div>
      <div class="mycards">
        <div id="card" class="row row-cols-1 row-cols-md-4 g-4">
          <div class="col">
            <div class="card">
              <img
                src="https://movie-phinf.pstatic.net/20210728_221/1627440327667GyoYj_JPEG/movie_image.jpg"
                class="card-img-top"
                alt="..."
              />
              <div class="card-body">
                <h5 class="card-title">김세원</h5>
                <p class="card-text">⭐⭐⭐</p>
                <p class="card-text">영화 코멘트</p>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="card">
              <img
                src="https://movie-phinf.pstatic.net/20210728_221/1627440327667GyoYj_JPEG/movie_image.jpg"
                class="card-img-top"
                alt="..."
              />
              <div class="card-body">
                <h5 class="card-title">헐크</h5>
                <p class="card-text">⭐⭐⭐</p>
                <p class="card-text">영화 코멘트</p>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="card">
              <img
                src="https://movie-phinf.pstatic.net/20210728_221/1627440327667GyoYj_JPEG/movie_image.jpg"
                class="card-img-top"
                alt="..."
              />
              <div class="card-body">
                <h5 class="card-title">아이언맨</h5>
                <p class="card-text">⭐⭐⭐</p>
                <p class="card-text">영화 코멘트</p>
              </div>
            </div>
          </div>
          <div class="col">
            <div class="card">
              <img
                src="https://movie-phinf.pstatic.net/20210728_221/1627440327667GyoYj_JPEG/movie_image.jpg"
                class="card-img-top"
                alt="..."
              />
              <div class="card-body">
                <h5 class="card-title">스파이더맨</h5>
                <p class="card-text">⭐⭐⭐</p>
                <p class="card-text">영화 코멘트</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="memberPage" class="memberPage">
      <div class="inner">
        <div class="topbox">
          <div class="btnbox">
            <button
              type="button"
              class="memberCloseBtn"
              onclick="memberPageClose()"
            >
              X
            </button>
          </div>
          <img
            src="https://i.namu.wiki/i/ssAoGp1eY-97_e-SnHnXOJuktEPq3XM3Fk_5fkkk7Tmaenv9fV-bU03Sj3u31OPhD6FT0h6AquIIXFWFc38xKvbkT5fmdYDrMCDATRj3zLJNA-8IPE10UqOWuz3udqtZ9t-hBwXnYxzimNCtzU8ryg.webp"
            class="memberImg"
            id="memberImg"
          />
        </div>

        <div id="memberContent" class="memberContent">
          <div class="contentbtnbox">
            <button type="button" onclick="modifyMember()">수정</button>
            <button type="button" onclick="DeleteMember()">삭제</button>
          </div>

          <table class="table table-borderless">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">이름</th>
                <th scope="col">mbti</th>
                <th scope="col">취미</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row">기본정보</th>
                <td id="memberName">이름</td>
                <td id="memberMBTI">INTP</td>
                <td id="memberHobby">취미</td>
              </tr>
              <tr>
                <th scope="row"></th>
                <td colspan="3"></td>
              </tr>
              <tr>
                <th scope="row">Github 주소</th>
                <td colspan="3" id="githubAddr">sparta@sparta.com</td>
              </tr>
              <tr>
                <th scope="row" colspan="4">자기소개</th>
              </tr>
              <tr>
                <td colspan="4" id="introduceMyself">
                  자기소개 내용자기소개 내용자기소개 내용자기소개 내용자기소개
                  내용자기소개 내용자기소개 내용자기소개 내용자기소개
                  내용자기소개 내용자기소개 내용자기소개 내용자기소개
                  내용자기소개 내용
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </body>
</html>
