<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>7전8기</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap");

      * {
        font-family: "Gowun Dodum", sans-serif;
      }
      footer {
        height: 100px;
        background-color: rgb(125, 7, 235);
        display: flex;
        justify-content: center;
        align-items: center;
        color: white;
      }

      footer > a {
        height: 50px;
        margin-right: 120px;
      }

      footer > vv {
        justify-content: center;
        flex-direction: column;
      }

      header {
        background-color: rgb(125, 7, 235);
      }
      header > a {
        margin-left: 120px;
        font-size: 28px;
        color: white;
      }

      .img-concert {
        height: 50px;
      }

      .memberPage {
        display: none;
        position: fixed;
        left: 0;
        top: 0;
        z-index: 10;
        width: 100%;
        height: 100%;
        background: rgba(61, 61, 61, 0.4);
        justify-content: center;
        align-items: center;
        overflow: auto;
      }
      .memberPage > .outer {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        height: 100%;
      }

      .memberPage > .outer > .inner {
        box-shadow: 0px 0px 10px 0px rgb(125, 7, 235);
        background: white;
        border-radius: 16px;
        width: 450px;
        max-height: 1000px;
        margin: auto;
      }

      .memberImg {
        border-radius: 16px 16px 0px 0px;
        width: 450px;
        min-height: 450px;
        max-height: 650px;
      }

      .memberContent {
        margin-bottom: 5px;
        padding: 0px 10px 10px 10px;
      }

      .btnbox {
        position: absolute;
        right: 0px;
        margin: 8px 8px 0px 0px;
      }

      .topbox {
        background-color: transparent;
        position: relative;
      }

      .contentbtnbox {
        float: right;
        margin-bottom: 5px;
        margin-right: 5px;
      }
      .contentbtnbox > button {
        font-size: 14px;
        border: 0px;
        background-color: transparent;
      }

      .commentbox {
        width: 1180px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: row;
        padding: 20px;
      }

      .commentbox > p {
        width: 980px;
        margin: 10px;
      }

      .commentbtnbox {
        float: right;
        width: fit-content;
        margin-left: 40px;
      }

      .commentbox .commentbtnbox > button {
        font-size: 12px;
        border: 0px;
        background-color: transparent;
      }

      .memberCloseBtn {
        color: white;
        font-size: 14px;
        border: 0px;
        background-color: transparent;
        height: 20px;
      }

      .mytitle {
        height: 700px;
        color: white;
        width: 100%;
        display: flex;
        justify-content: center;
        flex-direction: column;
        padding-left: 100px;
        padding-bottom: 100px;
        background-image: url("https://ahnjs0198.github.io/sparta/9154478.jpg");
        background-position: center;
        background-size: cover;
        margin-bottom: 100px;
      }

      .mytitle > h1 {
        font-size: 100px;
        margin-bottom: 50px;
        position: relative;
      }

      .mycards {
        width: 1200px;
        margin: 30px auto 200px auto;
      }

      .card {
        border-radius: 15px;
      }

      .card > img {
        height: 420px;
        border-radius: 15px 15px 0px 0px;
      }

      .mypostingbox {
        width: 500px;
        margin: 30px auto 0px auto;
        padding: 20px;
        box-shadow: 0px 0px 3px 0px blue;
        border-radius: 5px;
      }

      .savebtn {
        background-color: transparent;
        border: 0px;
        margin-top: 100px;
        margin-right: 60px;
        width: 100px;
        height: 40px;
      }

      .saveguestbtn {
        background-color: transparent;
        border: 0px;
        margin-top: 100px;
        margin-right: 60px;
        width: 100px;
        height: 40px;
      }

      header > a {
        margin-left: 120px;
        font-size: 28px;
      }

      .memberlabel {
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
        padding-left: 100px;
      }

      .memberlabel > label {
        font-size: 60px;
        margin: 50px auto 30px auto;
      }

      .mytitle > .wrapper {
        top: 580px;
        right: 80px;
        position: absolute;
      }

      .circle {
        border-radius: 60%;
        background-color: white;
        text-align: center;
        vertical-align: middle;
      }

      #reload {
        width: 300px;
        height: 300px;
        border-radius: 60%;
      }
      .card-title {
        padding-top: 5px;
        height: 30px;
        background-color: transparent;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      .card-body {
        background-color: rgba(201, 200, 200, 0.5);
        border-radius: 0px 0px 15px 15px;
        bottom: 0px;
        width: 100%;
      }

      .commentslistouter {
        z-index: 9;
        position: absolute;
        width: 1220px;
        height: 800px;
        border: 1px solid;
        border-radius: 30px;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .commentslist {
        -ms-overflow-style: none;
        overflow-y: auto;
        z-index: 10;
        position: absolute;
        width: 1200px;
        height: 750px;
        border: 1px solid white;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      .commentslist::-webkit-scrollbar {
        display: none;
      }

      .commentsbox {
        width: 100%;
        height: fit-content;
        margin: 80px auto 40px auto;
      }

      .commentsbox > .row {
        width: 1200px;
        margin: 40px auto 10px auto;
        padding-left: 50px;
      }

      .memberbox {
        width: 100%;
        height: fit-content;
      }

      img,
      svg {
        vertical-align: middle;
        border-radius: 15px;
      }
    </style>
    <script type="module">
      // Firebase SDK 라이브러리 가져오기
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import {
        collection,
        addDoc,
        updateDoc,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import {
        getDocs,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import {
        doc,
        deleteDoc,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      // Firebase 구성 정보 설정
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      const firebaseConfig = {
        apiKey: "AIzaSyBYxw3ecQiQXkldn41y9XaW3Wuua_bk8V8",
        authDomain: "introducetim.firebaseapp.com",
        projectId: "introducetim",
        storageBucket: "introducetim.appspot.com",
        messagingSenderId: "332412628842",
        appId: "1:332412628842:web:f3a7ebbf18a5de55c07f13",
      };
      // Firebase 인스턴스 초기화
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      // 멤버 전체 정보 가져오기
      async function getMemberData() {
        let docs = await getDocs(collection(db, "team"));

        docs.forEach((doc) => {
          let row = doc.data();
          let cardId = doc.id;
          let image = row["image"];
          let title = row["name"];
          let mbti = row["mbti"];

          let temp_html = `
            <div class="col" value="${cardId}">
                <div class="card h-100">
                  <img src="${image}" class="card-img-top" onerror="this.src='background.PNG'">
                  <div class="card-body">
                    <h5 class="card-title">${title}</h5>
                  </div>
                </div>
            </div>`;
          $("#card").append(temp_html);
        });
      }
      // 멤버 데이터 가져오기 실행
      getMemberData();

      // 방명록 전체 정보 가져오기
      async function getCommentsData() {
        let commentdocs = await getDocs(collection(db, "comments"));

        commentdocs.forEach((doc) => {
          let row = doc.data();
          let commentId = doc.id;
          let name = row["name"];
          let comment = row["comment"];
          let pw = row["pw"];
          let temp_html = `
  <div class="commentbox">
      <p>
        <span style="font-weight: bold" id="commentnamelabel">${name}</span> :<span id="comment">${comment}</span>
      </p>
      <div class="commentbtnbox">
        <input type="hidden" id="commentpw" value="${pw}" />
        <input type="hidden" id="commentId" value="${commentId}" />
        <button type="button" id="commentmodifybtn">수정</button>
        <button id="commentdelbtn" type="button">삭제</button>
      </div>
    </div>`;
          $("#commentslist").append(temp_html);
        });
      }
      // 방명록 데이터 가져오기 실행
      getCommentsData();
      $("#postingbtn").click(async function () {
        let commentname = $("#commentname").val();
        let commentcontents = $("#commentcontents").val();
        let commentpw = $("#commentpw").val();

        let doc = {
          commentname: commentname,
          commentcontents: commentcontents,
          commentpw: commentpw,
        };
        await addDoc(collection(db, "comments"), doc);
        alert("저장완료!");
        window.location.reload();
      });

      //멤버 카드 클릭시 실행 이벤트 - 멤버데이터 가져오고 페이지 오픈
      $(document).on("click", ".col", async function () {
        let docId = $(this).attr("value");

        // 파이어베이스에서 데이터 가져오기
        const docRef = doc(db, "team", docId);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          let row = docSnap.data();

          let image = row["image"];
          let name = row["name"];
          let mbti = row["mbti"];
          let hobby = row["hobby"];
          let blog = row["blog"];
          let introduceMyself = row["introduceMyself"];
          let m_pw = row["m_pw"];

          $("#memberImg").attr("src", image);
          $("#memberName").text(name);
          $("#memberMBTI").text(mbti);
          $("#memberHobby").text(hobby);
          $("#memberBlog").text(blog);
          $("#introduceMyself").text(introduceMyself);
          $("#m_pw").val(m_pw);
        } else {
          console.log("No such document!");
        }

        // 페이지 오픈 함수
        memberPageOpen(docId);
      });

      //멤버 삭제 함수
      // 동적으로 생성된 버튼에 이벤트를 적용하기 위해 이벤트 델리게이션 사용
      $(document).on("click", "#delbtn", async () => {
        let result = prompt("인증비밀번호를 입력하세요", "");
        let m_pw = $("#m_pw").val();
        if (result == m_pw) {
          let docId = $("#memberPage").attr("value");
          await deleteDoc(doc(db, "team", docId));
        }
        location.href = "index.html";
      });

      //방명록 삭제 함수
      // 동적으로 생성된 버튼에 이벤트를 적용하기 위해 이벤트 델리게이션 사용
      $(document).on("click", "#commentdelbtn", async (event) => {
        let result = prompt("방명록 개인 비밀번호를 입력하세요", "");
        let pw = event.target.parentElement.firstElementChild.value;
        if (result == pw) {
          let docId = event.target.parentElement.children[1].value;
          await deleteDoc(doc(db, "comments", docId));
        } else {
          alert("비밀번호가 틀렸습니다.");
        }
        location.reload();
      });

      //방명록 수정하기 버튼 이벤트
      let commentId = null;
      let commentPw = null;
      $(document).on("click", "#commentmodifybtn", async (event) => {
        $("#addcommentbox").show();
        $("#addcommentopen").text("방명록 등록 취소");

        commentId = event.target.parentElement.children[1].value;
        commentPw = event.target.parentElement.firstElementChild.value;

        let name =
          event.target.parentElement.parentElement.firstElementChild.children[0]
            .textContent;
        let comment =
          event.target.parentElement.parentElement.firstElementChild.children[1]
            .textContent;
        $("#commentname").val(name);
        $("#commentcontents").val(comment);
        // $("#commentpw").val(pw);
      });

      //방명록 등록하기 버튼 이벤트
      $(document).on("click", "#addcommentbtn", async () => {
        let name = $("#commentname").val();
        let comment = $("#commentcontents").val();
        let pw = $("#commentpw").val();

        let docData = {
          name: name,
          comment: comment,
          pw: pw,
        };

        if (commentPw == pw) {
          const docRef = doc(db, "comments", commentId);
          await updateDoc(docRef, docData);
        } else if (commentPw == null) {
          await addDoc(collection(db, "comments"), docData);
        } else {
          alert("비밀번호가 틀렸습니다.");
        }

        commentId = null;
        commentPw = null;
        location.reload();
      });
    </script>

    <script>
      window.onscroll = function () {
        scrollRotate();
      };

      function scrollRotate() {
        if (window.pageYOffset < 1600) {
          let image = document.getElementById("reload");
          image.style.transform = "rotate(" + window.pageYOffset / 5 + "deg)";
        }
      }

      //멤버 카드 페이지 열기
      function memberPageOpen(docId) {
        $("#memberPage").attr("value", docId);
        $("#memberPage").fadeIn();
      }
      //멤버 카드 페이지 닫기
      function memberPageClose() {
        $("#memberPage").fadeOut();
      }

      //멤버 수정 함수
      function modifyMember() {
        let m_pw = $("#m_pw").val();
        let result = prompt("인증비밀번호를 입력하세요", "");
        if (result == m_pw) {
          let docId = $("#memberPage").attr("value");
          location.href = "enrollment.html?id=" + docId;
        } else {
          alert("비밀번호가 틀렸습니다.");
        }
      }

      //멤버 추가 함수
      function addMember() {
        location.href = "enrollment.html";
      }

      //멤버 삭제 함수
      function DeleteMember() {
        let m_pw = $("#m_pw").val();
        let result = prompt("인증비밀번호를 입력하세요", "");
        if (result == m_pw) {
          $("#delbtn").trigger("click");
          window.location.reload();
        }
      }

      // 외부영역 클릭 시 팝업 닫기
      $(document).mouseup(function (e) {
        var LayerPopup = $(".inner");
        if (LayerPopup.has(e.target).length === 0) {
          $("#memberPage").fadeOut();
        }
      });

      //방명록 등록 toggle 함수
      function addcommentboxtoggle() {
        if ($("#addcommentbox").css("display") == "none") {
          $("#addcommentbox").show();
          $("#addcommentopen").text("방명록 등록 취소");
        } else {
          $("#addcommentbox").hide();
          $("#addcommentopen").text("방명록 등록");
        }
      }
    </script>
  </head>

  <body>
    <!-- Navbar -->
    <header class="p-3 text-bg-dark">
      <a href="index.html" class="nav-link px-2 text-light">7전8기</a>
    </header>

    <div class="mytitle">
      <div class="wrapper">
        <div class="circle">
          <img id="reload" src="circle.PNG" alt="scroll" />
        </div>
      </div>
      <h1>7전8기</h1>
      <h3>7번을 넘어져도 8번 일어나 목표에 전념하는 7조 입니다.</h3>
      <h3>7조 특징 : 저희는 안되면 될 때까지 도전하는 사람들이 모였습니다.</h3>
      <h3>7조의 약속 : 취업할 때까지 모두 포기하지 않는다!</h3>
      <h3>포기하지 않는 열정과 노력을 보여드리겠습니다.</h3>
      <h3>스파르타와 함께!</h3>
    </div>

    <div class="memberbox">
      <div class="memberlabel">
        <label>멤버 소개</label>
        <button type="button" class="savebtn" onclick="addMember()">
          멤버 추가
        </button>
      </div>
      <hr style="margin: 0px 50px 0px 50px" />

      <div class="mycards">
        <div id="card" class="row row-cols-1 row-cols-md-4 g-4"></div>
      </div>
    </div>

    <div class="commentsbox">
      <div class="memberlabel">
        <label>방명록</label>
        <button
          type="button"
          class="savebtn"
          id="addcommentopen"
          onclick="addcommentboxtoggle()"
        >
          방명록 등록
        </button>
      </div>
      <hr style="margin: 0px 50px 0px 50px" />
      <div
        class="row row-cols-lg-auto g-3 align-items-center"
        id="addcommentbox"
        style="display: none"
      >
        <div class="col-sm-2">
          <div class="form-floating">
            <input
              type="text"
              class="form-control"
              id="commentname"
              placeholder="이름"
            />
            <label for="commentname">이름</label>
          </div>
        </div>
        <div class="col-sm-6">
          <div class="form-floating">
            <input
              type="email"
              class="form-control"
              id="commentcontents"
              placeholder="내용"
            />
            <label for="commentcontents">내용</label>
          </div>
        </div>
        <div class="col-sm-2">
          <div class="form-floating">
            <input
              type="email"
              class="form-control"
              id="commentpw"
              placeholder="비밀번호"
            />
            <label for="commentpw">비밀번호</label>
          </div>
        </div>
        <div class="col-sm-2">
          <button type="button" class="btn btn-outline-dark" id="addcommentbtn">
            등록하기
          </button>
        </div>
      </div>

      <div style="position: relative; width: 100%; height: 900px">
        <div class="commentslistouter"></div>
        <div class="commentslist" id="commentslist"></div>
      </div>
    </div>

    <div id="memberPage" class="memberPage">
      <div class="outer">
        <div class="inner">
          <div class="topbox">
            <div class="btnbox">
              <button
                type="button"
                class="memberCloseBtn"
                onclick="memberPageClose()"
              >
                X
              </button>
            </div>
            <img
              src="background.PNG"
              class="memberImg"
              id="memberImg"
              onerror="this.src='background.PNG'"
            />
          </div>

          <div id="memberContent" class="memberContent">
            <div class="contentbtnbox">
              <input type="hidden" id="m_pw" />
              <button type="button" onclick="modifyMember()">수정</button>
              <button id="delbtn" type="button">삭제</button>
            </div>

            <table class="table table-borderless">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">이름</th>
                  <th scope="col">mbti</th>
                  <th scope="col">취미</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <th scope="row">기본정보</th>
                  <td id="memberName">이름</td>
                  <td id="memberMBTI">INTP</td>
                  <td id="memberHobby">취미</td>
                </tr>
                <tr>
                  <th scope="row">블로그 주소</th>
                  <td colspan="3" id="memberBlog">sparta@sparta.com</td>
                </tr>
                <tr>
                  <th scope="row" colspan="4">자기소개</th>
                </tr>
                <tr>
                  <td colspan="4" id="introduceMyself">자기소개 내용</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </body>
  <footer>
    <div class="vv" style="margin: 10px">
      <div style="text-align: center">김지윤 tstory</div>
      <a href="https://jy3574.tistory.com/">
        <img
          class="img-concert"
          src="https://ahnjs0198.github.io/sparta/tstory.png"
        />
      </a>
    </div>
    <div class="vv" style="margin: 10px">
      <div style="text-align: center">안재솔 tstory</div>
      <a href="https://play-everyday.tistory.com">
        <img
          class="img-concert"
          src="https://ahnjs0198.github.io/sparta/tstory.png"
        />
      </a>
    </div>
    <div class="vv" style="margin: 10px">
      <div style="text-align: center">박용재 velog</div>
      <a href="https://velog.io/@skykid/posts">
        <img
          class="img-concert"
          src="https://ahnjs0198.github.io/sparta/velog.png"
        />
      </a>
    </div>
    <div class="vv" style="margin: 10px">
      <div style="text-align: center">김세원 velog</div>
      <a href="https://velog.io/@taketheking/posts">
        <img
          class="img-concert"
          src="https://ahnjs0198.github.io/sparta/velog.png"
        />
      </a>
    </div>
  </footer>
</html>
